<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>اختبار عرض البيانات المالية</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .summary-item { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; }
        .summary-value { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .summary-label { font-size: 14px; color: #666; }
        .text-success { color: #28a745; }
        .text-danger { color: #dc3545; }
        .test-section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>اختبار عرض البيانات المالية للعميل</h1>
    
    <div class="test-section">
        <h2>البيانات الفعلية للعميل "الفتح للإنشائات"</h2>
        <ul>
            <li>الرصيد الافتتاحي: 1,000 جنيه (عليه)</li>
            <li>إجمالي التوريدات: 11,092 جنيه</li>
            <li>إجمالي المدفوعات: 300 جنيه</li>
            <li>إجمالي التسويات: 0 جنيه</li>
            <li><strong>الرصيد الصافي: 11,792 جنيه (عليه)</strong></li>
        </ul>
        
        <p><strong>الحساب:</strong> 1,000 + 11,092 + 0 - 300 = 11,792 جنيه (عليه)</p>
    </div>
    
    <div class="test-section">
        <h2>العرض المُصحح</h2>
        <div id="summaryGrid" class="summary-grid"></div>
    </div>
    
    <div class="test-section">
        <h2>اختبار النقر على النص</h2>
        <p>هذا نص عادي يحتوي على كلمة "إنشاء تقرير التوريدات" - يجب ألا يفتح التقرير عند النقر عليه</p>
        <button onclick="alert('تم النقر على الزر!')">إنشاء تقرير التوريدات</button>
        <p>الزر أعلاه يجب أن يعمل، لكن النص العادي لا يجب أن يفتح التقرير</p>
    </div>

    <script>
        function formatCurrency(amount) {
            return Number(amount || 0).toLocaleString('ar-EG') + ' ج.م.';
        }

        function renderSummary(totals) {
            const container = document.getElementById('summaryGrid');
            const balance = totals.balance || 0;
            const openingBalance = totals.openingBalance || 0;
            
            // Balance logic: Positive = they owe us (عليه), Negative = we owe them (له)
            const balanceClass = balance > 0 ? 'text-success' : balance < 0 ? 'text-danger' : '';
            const balanceLabel = balance > 0 ? '(عليه )' : balance < 0 ? '(له )' : '';
            
            // Opening balance logic: Positive = they owe us (عليه), Negative = we owe them (له)
            const openingClass = openingBalance > 0 ? 'text-success' : openingBalance < 0 ? 'text-danger' : '';
            const openingLabel = openingBalance > 0 ? '(عليه)' : openingBalance < 0 ? '(له)' : '';
            
            container.innerHTML = `
                <div class="summary-item">
                    <div class="summary-value ${openingClass}">${formatCurrency(Math.abs(openingBalance))} ${openingLabel}</div>
                    <div class="summary-label">الرصيد الافتتاحي</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value text-success">${formatCurrency(totals.totalDeliveries || 0)}</div>
                    <div class="summary-label">إجمالي التوريدات</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value text-danger">${formatCurrency(totals.totalPayments || 0)}</div>
                    <div class="summary-label">إجمالي المدفوعات</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value ${totals.totalAdjustments > 0 ? 'text-success' : totals.totalAdjustments < 0 ? 'text-danger' : ''}">${formatCurrency(Math.abs(totals.totalAdjustments || 0))} ${totals.totalAdjustments > 0 ? '(عليه)' : totals.totalAdjustments < 0 ? '(له)' : ''}</div>
                    <div class="summary-label">إجمالي التعديلات</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value ${balanceClass}">${formatCurrency(Math.abs(balance))} ${balanceLabel}</div>
                    <div class="summary-label">الرصيد الصافي</div>
                </div>
            `;
        }

        // Test data
        const testTotals = {
            openingBalance: 1000,
            totalDeliveries: 11092,
            totalPayments: 300,
            totalAdjustments: 0,
            balance: 11792
        };

        // Render the corrected display
        renderSummary(testTotals);
        
        // Test event delegation fix
        document.addEventListener('click', function(e) {
            // Handle report generation buttons - only for actual buttons
            if (e.target.tagName === 'BUTTON' && e.target.textContent.includes('إنشاء تقرير التوريدات')) {
                alert('تم تفعيل تقرير التوريدات من الزر فقط!');
            }
        });
    </script>
</body>
</html>