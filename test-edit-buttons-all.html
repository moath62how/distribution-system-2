<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ - Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; }
        .test-section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .btn { padding: 10px 20px; margin: 10px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-secondary { background: #6c757d; color: white; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .main-content { padding: 20px; border: 2px dashed #ccc; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Body</h1>
    
    <div class="test-section">
        <h2>1. Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</h2>
        
        <h3>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
        <button class="btn btn-secondary" id="editClientBtn">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
        <div id="clientResult"></div>
        
        <h3>Ø§Ù„ÙƒØ³Ø§Ø±Ø§Øª</h3>
        <button class="btn btn-secondary" id="editCrusherBtn">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ³Ø§Ø±Ø©</button>
        <div id="crusherResult"></div>
        
        <h3>Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ†</h3>
        <button class="btn btn-secondary" id="editContractorBtn">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</button>
        <div id="contractorResult"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Body</h2>
        <p class="info">Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØªØ§Ù„ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù„Ø§ ÙŠÙØªØ­ ØªÙ‚Ø§Ø±ÙŠØ±:</p>
        
        <div class="main-content" id="testMainContent">
            <p>Ù‡Ø°Ø§ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (main-content)</p>
            <p>Ø§Ù„Ù†Ù‚Ø± Ù‡Ù†Ø§ ÙŠØ¬Ø¨ Ø£Ù„Ø§ ÙŠÙØªØ­ Ø£ÙŠ ØªÙ‚Ø±ÙŠØ±</p>
            <p>Ù†Øµ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© "ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª" - ÙŠØ¬Ø¨ Ø£Ù„Ø§ ÙŠÙØªØ­ Ø´ÙŠØ¡</p>
        </div>
        
        <div id="bodyClickResult"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØµØ­ÙŠØ­Ø©</h2>
        <p class="info">Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙŠØ¬Ø¨ Ø£Ù† ØªØ¹Ù…Ù„:</p>
        
        <button class="btn btn-secondary" data-action="generate-deliveries-report">ğŸ“„ Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª</button>
        <button class="btn btn-secondary" data-action="generate-account-statement">ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        
        <div id="reportResult"></div>
    </div>

    <script>
        // Mock data for testing
        let clientData = { client: { id: 1, name: 'Ø¹Ù…ÙŠÙ„ ØªØ¬Ø±ÙŠØ¨ÙŠ', phone: '123', opening_balance: 1000 } };
        let crusherData = { crusher: { id: 1, name: 'ÙƒØ³Ø§Ø±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©' } };
        let contractorData = { contractor: { id: 1, name: 'Ù…Ù‚Ø§ÙˆÙ„ ØªØ¬Ø±ÙŠØ¨ÙŠ', opening_balance: 500 } };
        
        // Mock functions
        function showModal(modalId) {
            console.log('showModal called with:', modalId);
            alert(`ØªÙ… ÙØªØ­ ${modalId} Ø¨Ù†Ø¬Ø§Ø­!`);
        }
        
        function generateDeliveriesReport() {
            console.log('generateDeliveriesReport called');
            document.getElementById('reportResult').innerHTML += '<p class="success">âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª</p>';
        }
        
        function generateAccountStatement() {
            console.log('generateAccountStatement called');
            document.getElementById('reportResult').innerHTML += '<p class="success">âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨</p>';
        }
        
        // Edit functions
        function openEditClientModal() {
            console.log('openEditClientModal called');
            console.log('clientData:', clientData);
            
            if (!clientData || !clientData.client) {
                console.error('No client data available');
                document.getElementById('clientResult').innerHTML = '<p class="error">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…ÙŠÙ„</p>';
                return;
            }
            
            document.getElementById('clientResult').innerHTML = '<p class="success">âœ… ØªÙ… ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</p>';
            showModal('editClientModal');
        }
        
        function openEditCrusherModal() {
            console.log('openEditCrusherModal called');
            console.log('crusherData:', crusherData);
            
            if (!crusherData || !crusherData.crusher) {
                console.error('No crusher data available');
                document.getElementById('crusherResult').innerHTML = '<p class="error">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ³Ø§Ø±Ø©</p>';
                return;
            }
            
            document.getElementById('crusherResult').innerHTML = '<p class="success">âœ… ØªÙ… ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ³Ø§Ø±Ø©</p>';
            showModal('editCrusherModal');
        }
        
        function openEditContractorModal() {
            console.log('openEditContractorModal called');
            console.log('contractorData:', contractorData);
            
            if (!contractorData || !contractorData.contractor) {
                console.error('No contractor data available');
                document.getElementById('contractorResult').innerHTML = '<p class="error">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù‚Ø§ÙˆÙ„</p>';
                return;
            }
            
            document.getElementById('contractorResult').innerHTML = '<p class="success">âœ… ØªÙ… ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</p>';
            showModal('editContractorModal');
        }
        
        // Setup event handlers
        function setupEditHandlers() {
            console.log('Setting up edit handlers...');
            
            // Client edit button
            const clientBtn = document.getElementById('editClientBtn');
            if (clientBtn) {
                clientBtn.addEventListener('click', function() {
                    console.log('Client edit button clicked!');
                    openEditClientModal();
                });
            }
            
            // Crusher edit button
            const crusherBtn = document.getElementById('editCrusherBtn');
            if (crusherBtn) {
                crusherBtn.addEventListener('click', function() {
                    console.log('Crusher edit button clicked!');
                    openEditCrusherModal();
                });
            }
            
            // Contractor edit button
            const contractorBtn = document.getElementById('editContractorBtn');
            if (contractorBtn) {
                contractorBtn.addEventListener('click', function() {
                    console.log('Contractor edit button clicked!');
                    openEditContractorModal();
                });
            }
        }
        
        // Event delegation for reports (improved version)
        document.addEventListener('click', function(e) {
            const action = e.target.getAttribute('data-action');
            
            // Handle data-action attributes only
            if (action === 'generate-deliveries-report') {
                generateDeliveriesReport();
                return;
            } else if (action === 'generate-account-statement') {
                generateAccountStatement();
                return;
            }
            
            // Log unwanted clicks for debugging
            if (e.target.closest('.main-content') && 
                e.target.tagName !== 'BUTTON' && 
                e.target.textContent && 
                e.target.textContent.includes('ØªÙ‚Ø±ÙŠØ±')) {
                console.log('Unwanted click detected on:', e.target);
                document.getElementById('bodyClickResult').innerHTML += '<p class="error">âŒ Ù†Ù‚Ø±Ø© ØºÙŠØ± Ù…Ø±ØºÙˆØ¨Ø© ØªÙ… Ù…Ù†Ø¹Ù‡Ø§</p>';
                e.stopPropagation();
            }
        });
        
        // Track clicks on main content
        document.getElementById('testMainContent').addEventListener('click', function(e) {
            console.log('Click on main content:', e.target);
            document.getElementById('bodyClickResult').innerHTML += '<p class="info">ğŸ–±ï¸ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰: ' + e.target.tagName + '</p>';
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up handlers...');
            setupEditHandlers();
        });
    </script>
</body>
</html>