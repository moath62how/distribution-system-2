# ุฅุตูุงุญ ุฎุทุฃ ุงููุฏููุนุงุช 500

## ุงููุดููุฉ
ูุงู ุงูุฎุงุฏู ูุนุทู ุฎุทุฃ 500 ุนูุฏ ูุญุงููุฉ ุฅุถุงูุฉ ูุฏููุนุงุชุ ููุงู ูุฑุณู ุตูุญุฉ HTML ุจุฏูุงู ูู ุฑุณุงูุฉ ุฎุทุฃ JSON.

## ุงูุฃุณุจุงุจ ุงูููุชุดูุฉ

### 1. ุนููุฏ payment_image ุบูุฑ ููุฌูุฏ
- ุงูุนููุฏ ูู ููู ููุฌูุฏุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงูููุฏ ูุญุงูู ุฅุฏุฑุงุฌ ุจูุงูุงุช ูู ุนููุฏ ุบูุฑ ููุฌูุฏ

### 2. ูุนุงูุฌ ุงูุฃุฎุทุงุก ุฎุงุทุฆ
- ูุนุงูุฌ ุงูุฃุฎุทุงุก ูู ุงูุฎุงุฏู ูุงู ูุฑุณู HTML ููุทูุจุงุช API
- ูุฐุง ูุณุจุจ ูุดุงูู ูู parsing JSON ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

### 3. ูุนุงูุฌุฉ ุงูุตูุฑ ุบูุฑ ุตุญูุญุฉ
- ุงูููุฏ ูุงู ูุญุงูู ูุฑุงุกุฉ ุงูุตูุฑ ุจุดูู ุบูุฑ ูุชุฒุงูู ุจุทุฑููุฉ ุฎุงุทุฆุฉ
- ูู ุชูู ููุงู ูุนุงูุฌุฉ ููุฃุฎุทุงุก ูู ูุฑุงุกุฉ ุงูุตูุฑ

## ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ

### โ 1. ุฅุถุงูุฉ ุฃุนูุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
node add-payment-image-column.js
```

**ุงููุชูุฌุฉ:**
- โ payment_image column added to payments table
- โ payment_image column added to crusher_payments table  
- โ payment_image column added to contractor_payments table
- โ payment_image column added to adjustments table

### โ 2. ุฅุตูุงุญ ูุนุงูุฌ ุงูุฃุฎุทุงุก ูู ุงูุฎุงุฏู
**ุงูููู:** `backend/server.js`

**ูุจู:**
```javascript
app.use((err, req, res, next) => {
  console.error('Error:', err);
  res.status(500).render('error', {
    title: 'ุฎุทุฃ',
    message: 'ุญุฏุซ ุฎุทุฃ ูู ุงูุณูุฑูุฑ'
  });
});
```

**ุจุนุฏ:**
```javascript
app.use((err, req, res, next) => {
  console.error('Error:', err);
  
  // Check if this is an API request
  if (req.path.startsWith('/api/')) {
    return res.status(500).json({
      message: 'ุญุฏุซ ุฎุทุฃ ูู ุงูุณูุฑูุฑ',
      error: process.env.NODE_ENV === 'development' ? err.message : 'Internal Server Error'
    });
  }
  
  // For web requests, render error page
  res.status(500).render('error', {
    title: 'ุฎุทุฃ',
    message: 'ุญุฏุซ ุฎุทุฃ ูู ุงูุณูุฑูุฑ'
  });
});
```

### โ 3. ุฅุตูุงุญ ูุนุงูุฌุฉ ุงูุตูุฑ
**ุงูููู:** `backend/public/js/clients-details.js`

**ุงููุดููุฉ:** Promise ุบูุฑ ุตุญูุญ ูู ูุฑุงุกุฉ ุงูุตูุฑ
**ุงูุญู:** ุฅุถุงูุฉ ูุนุงูุฌุฉ ุตุญูุญุฉ ููุฃุฎุทุงุก ู Promise

```javascript
// Handle image upload
const imageFile = document.getElementById('paymentImage').files[0];
if (imageFile) {
    try {
        const payment_image = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.onerror = reject;
            reader.readAsDataURL(imageFile);
        });
        paymentData.payment_image = payment_image;
    } catch (error) {
        console.error('Error reading image:', error);
        showMessage('paymentMessage', 'ุฎุทุฃ ูู ูุฑุงุกุฉ ุงูุตูุฑุฉ', 'error');
        return;
    }
}
```

### โ 4. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู
- ุฅููุงู ุฌููุน ุนูููุงุช Node.js ุงููุฏููุฉ
- ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ูุน ุงูุชุญุฏูุซุงุช ุงูุฌุฏูุฏุฉ
- ุงูุชุฃูุฏ ูู ุนูู ุงูุฎุงุฏู ุนูู ุงููููุฐ 5000

## ุงููููุงุช ุงููุญุฏุซุฉ

1. **add-payment-image-column.js** - ุณูุฑูุจุช ุฅุถุงูุฉ ุงูุฃุนูุฏุฉ
2. **backend/server.js** - ุฅุตูุงุญ ูุนุงูุฌ ุงูุฃุฎุทุงุก
3. **backend/public/js/clients-details.js** - ุฅุตูุงุญ ูุนุงูุฌุฉ ุงูุตูุฑ
4. **test-payment-fix.html** - ููู ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญุงุช

## ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญุงุช

### 1. ุงุฎุชุจุงุฑ ุงูุฎุงุฏู:
```javascript
fetch('http://localhost:5000/api/clients')
  .then(response => response.json())
  .then(data => console.log('Server working:', data))
```

### 2. ุงุฎุชุจุงุฑ ุงููุฏููุนุงุช:
1. ุงูุชุญ `backend/public/clients-details.html?id=1`
2. ุงููุฑ "ุฅุถุงูุฉ ุฏูุนุฉ"
3. ุงุฎุชุฑ ุทุฑููุฉ ุฏูุน "ุจููู"
4. ุงุฑูุน ุตูุฑุฉ
5. ุงุญูุธ - ูุฌุจ ุฃู ูุนูู ุจุฏูู ุฃุฎุทุงุก

### 3. ุงุฎุชุจุงุฑ ุฑูุน ุงูุตูุฑ:
- ุชุฃูุฏ ูู ุธููุฑ ูุนุงููุฉ ุงูุตูุฑุฉ
- ุชุฃูุฏ ูู ุญูุธ ุงูุตูุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุชุฃูุฏ ูู ุนุฏู ุธููุฑ ุฃุฎุทุงุก ูู ูุญุฏุฉ ุงูุชุญูู

## ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### โ ูุง ูุฌุจ ุฃู ูุนูู ุงูุขู:
- ุฅุถุงูุฉ ูุฏููุนุงุช ุจุฏูู ุฃุฎุทุงุก 500
- ุฑูุน ุตูุฑ ุงููุฏููุนุงุช
- ุฑุณุงุฆู ุฎุทุฃ JSON ุตุญูุญุฉ ุจุฏูุงู ูู HTML
- ูุนุงููุฉ ุงูุตูุฑ ูุจู ุงูุฑูุน
- ูุณุญ ุงูููุงุฐุฌ ุจุนุฏ ุงูุญูุธ

### โ๏ธ ููุงุญุธุงุช ูููุฉ:
- ุงูุตูุฑ ุชูุญูุธ ูู base64 ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุฏ ุชุญุชุงุฌ ูุชุญุณูู ูุฐุง ูููููุงุช ุงููุจูุฑุฉ ูุงุญูุงู
- ุชุฃูุฏ ูู ุฃู XAMPP ูุนูู ููุงุนุฏุฉ ุงูุจูุงูุงุช

## ุฎุทูุงุช ุงูุชุญูู ุงูููุงุฆู

1. **ุชุดุบูู ููู ุงูุงุฎุชุจุงุฑ:**
   ```
   ุงูุชุญ test-payment-fix.html ูู ุงููุชุตูุญ
   ```

2. **ุงุฎุชุจุงุฑ ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ:**
   - ุฅุถุงูุฉ ุฏูุนุฉ ุจุฏูู ุตูุฑุฉ โ
   - ุฅุถุงูุฉ ุฏูุนุฉ ูุน ุตูุฑุฉ โ
   - ุชุญุฑูุฑ ุฏูุนุฉ ููุฌูุฏุฉ โ
   - ุญุฐู ุฏูุนุฉ โ

3. **ุงูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก:**
   - ูุง ุชูุฌุฏ ุฃุฎุทุงุก 500 โ
   - ุฑุณุงุฆู ุงูุฎุทุฃ ุจุตูุบุฉ JSON โ
   - ูุนุงูุฌุฉ ุงูุตูุฑ ุชุนูู โ

## ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ุฌููุน ุงููุดุงูู ุงููุชุนููุฉ ุจุฎุทุฃ 500 ูู ุงููุฏููุนุงุช:
- โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุญุฏุซุฉ
- โ ูุนุงูุฌ ุงูุฃุฎุทุงุก ูุตุญุญ  
- โ ูุนุงูุฌุฉ ุงูุตูุฑ ุชุนูู
- โ ุงูุฎุงุฏู ูุนูู ุจุดูู ุตุญูุญ

ุงููุธุงู ุฌุงูุฒ ุงูุขู ููุงุณุชุฎุฏุงู! ๐