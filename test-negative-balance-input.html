<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>اختبار إدخال الرصيد السالب</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input { width: 200px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .test-section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .btn { padding: 10px 20px; margin: 10px; border: none; border-radius: 5px; cursor: pointer; background: #007bff; color: white; }
    </style>
</head>
<body>
    <h1>اختبار إدخال الرصيد الافتتاحي السالب</h1>
    
    <div class="test-section">
        <h2>1. نموذج العملاء - إضافة جديد</h2>
        <div class="form-group">
            <label for="clientBalance">الرصيد الافتتاحي (جنيه)</label>
            <input type="text" id="clientBalance" name="opening_balance" placeholder="0.00">
            <small>موجب = العميل يدين لنا، سالب = نحن ندين للعميل</small>
        </div>
        <button class="btn" onclick="testValue('clientBalance')">اختبار القيمة</button>
        <div id="clientResult"></div>
    </div>
    
    <div class="test-section">
        <h2>2. نموذج العملاء - تعديل</h2>
        <div class="form-group">
            <label for="editClientBalance">الرصيد الافتتاحي (جنيه)</label>
            <input type="text" id="editClientBalance" name="opening_balance" placeholder="0.00">
            <small>موجب = العميل يدين لنا، سالب = نحن ندين للعميل</small>
        </div>
        <button class="btn" onclick="testValue('editClientBalance')">اختبار القيمة</button>
        <div id="editClientResult"></div>
    </div>
    
    <div class="test-section">
        <h2>3. نموذج المقاولين - تعديل</h2>
        <div class="form-group">
            <label for="contractorBalance">الرصيد الافتتاحي (جنيه)</label>
            <input type="text" id="contractorBalance" name="opening_balance" placeholder="0.00">
            <small>موجب = المقاول يدين لنا، سالب = نحن ندين للمقاول</small>
        </div>
        <button class="btn" onclick="testValue('contractorBalance')">اختبار القيمة</button>
        <div id="contractorResult"></div>
    </div>
    
    <div class="test-section">
        <h2>4. اختبار SweetAlert للمقاولين</h2>
        <button class="btn" onclick="testSweetAlert()">اختبار إضافة مقاول</button>
        <div id="sweetAlertResult"></div>
    </div>
    
    <div class="test-section">
        <h2>قيم اختبار مقترحة</h2>
        <ul>
            <li><strong>-1000</strong> - رقم سالب بسيط</li>
            <li><strong>-1500.50</strong> - رقم سالب بكسور</li>
            <li><strong>1000</strong> - رقم موجب</li>
            <li><strong>0</strong> - صفر</li>
            <li><strong>-0.01</strong> - رقم سالب صغير</li>
        </ul>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function testValue(inputId) {
            const input = document.getElementById(inputId);
            const value = input.value;
            const resultDiv = document.getElementById(inputId.replace('Balance', 'Result').replace('edit', 'edit'));
            
            console.log(`Testing ${inputId}: "${value}"`);
            
            // Test parsing
            const parsed = parseFloat(value);
            const isValid = !isNaN(parsed);
            
            let result = `<p><strong>القيمة المدخلة:</strong> "${value}"</p>`;
            result += `<p><strong>القيمة المحولة:</strong> ${parsed}</p>`;
            result += `<p><strong>صالحة؟</strong> <span class="${isValid ? 'success' : 'error'}">${isValid ? 'نعم' : 'لا'}</span></p>`;
            
            if (isValid) {
                if (parsed > 0) {
                    result += `<p class="success">✅ رصيد موجب - العميل/المقاول يدين لنا</p>`;
                } else if (parsed < 0) {
                    result += `<p class="success">✅ رصيد سالب - نحن ندين للعميل/المقاول</p>`;
                } else {
                    result += `<p class="success">✅ رصيد متوازن</p>`;
                }
            } else {
                result += `<p class="error">❌ قيمة غير صالحة</p>`;
            }
            
            document.getElementById(inputId + 'Result').innerHTML = result;
        }
        
        async function testSweetAlert() {
            try {
                const { value: opening } = await Swal.fire({ 
                    title: 'رصيد افتتاحي (اختياري)', 
                    input: 'text', 
                    inputPlaceholder: '0', 
                    inputValue: '0', 
                    showCancelButton: true,
                    inputValidator: (value) => {
                        const parsed = parseFloat(value);
                        if (isNaN(parsed)) {
                            return 'يرجى إدخال رقم صالح';
                        }
                    }
                });
                
                if (opening !== undefined) {
                    const parsed = parseFloat(opening);
                    let result = `<p><strong>القيمة من SweetAlert:</strong> "${opening}"</p>`;
                    result += `<p><strong>القيمة المحولة:</strong> ${parsed}</p>`;
                    
                    if (parsed > 0) {
                        result += `<p class="success">✅ رصيد موجب</p>`;
                    } else if (parsed < 0) {
                        result += `<p class="success">✅ رصيد سالب</p>`;
                    } else {
                        result += `<p class="success">✅ رصيد متوازن</p>`;
                    }
                    
                    document.getElementById('sweetAlertResult').innerHTML = result;
                }
            } catch (error) {
                document.getElementById('sweetAlertResult').innerHTML = `<p class="error">خطأ: ${error.message}</p>`;
            }
        }
        
        // Auto-fill test values
        document.getElementById('clientBalance').value = '-1000';
        document.getElementById('editClientBalance').value = '-1500.50';
        document.getElementById('contractorBalance').value = '-500';
    </script>
</body>
</html>